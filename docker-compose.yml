services:
  # ==================== RFRP 服务端 ====================
  # 反向代理服务端，提供 QUIC 协议支持和 Web 管理界面
  rfrps:
    image: docker.yunnet.top/all/rfrp:latest
    container_name: rfrps
    restart: unless-stopped
    # 端口映射配置
    ports:
      # QUIC 主服务端口 (必须使用 UDP 协议)
      - "7000:7000/udp"
      # Web 管理界面端口 (HTTP)
      # 访问: http://your-server-ip:3000
      # 默认账号: admin (密码见首次启动日志)
      - "3000:3000"
    # 卷挂载配置
    volumes:
      # 服务端配置文件 (只读)
      - ./rfrps.toml:/app/rfrps.toml:ro
      # 数据持久化目录 (SQLite 数据库、日志等)
      - ./data:/app/data
    # 环境变量配置
    environment:
      # 时区设置
      - TZ=Asia/Shanghai
      # 日志级别: trace, debug, info, warn, error
      - RUST_LOG=info
    command: ["/app/rfrps"]
    # 健康检查 (用于监控服务状态)
    healthcheck:
      test: ["CMD-SHELL", "wget -q --spider http://localhost:3000/api/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
  # ==================== RFRP 客户端 (可选) ====================
  # 如果需要在同一台机器上运行客户端，取消下面的注释
  # 通常客户端部署在需要被访问的内网机器上
  rfrpc:
    image: docker.yunnet.top/all/rfrp:latest
    container_name: rfrpc
    restart: unless-stopped
    volumes:
      - ./rfrpc.toml:/app/rfrpc.toml:ro
    environment:
      - TZ=Asia/Shanghai
      - RUST_LOG=info
    command: ["/app/rfrpc"]