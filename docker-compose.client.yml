version: '3.8'

services:
  # ==================== RFRP Client (Agent Client) ====================
  # 客户端服务，运行在内网机器上，连接本地服务并通过节点暴露到公网
  client:
    image: docker.yunnet.top/all/rfrp:latest
    container_name: rfrp-client
    restart: unless-stopped

    # 网络模式
    # 使用 host 模式可以直接访问宿主机的服务
    # 如果需要访问其他容器，可以使用 bridge 模式并配置网络
    network_mode: host

    # 如果使用 bridge 模式，取消下面的注释并注释掉上面的 network_mode
    # ports:
    #   # 根据需要暴露的本地服务端口调整
    #   # 例如: - "8080:8080"

    # 环境变量
    environment:
      # Controller 地址（必填）
      # 格式: http://controller-ip:3100
      - CONTROLLER_URL=http://your-controller-ip:3100

      # 客户端 Token（必填）
      # 从 Controller Web 界面的客户端管理页面获取
      - CLIENT_TOKEN=your-client-token-here

      # 时区设置
      - TZ=Asia/Shanghai

      # 日志级别
      - RUST_LOG=info,tokio_kcp=off

    # 启动命令
    command:
      - /app/agent
      - client
      - --controller-url
      - ${CONTROLLER_URL}
      - --token
      - ${CLIENT_TOKEN}

    # 如果需要访问宿主机的服务，可以添加 extra_hosts
    # extra_hosts:
    #   - "host.docker.internal:host-gateway"

    # 网络配置（仅在使用 bridge 模式时）
    # networks:
    #   - rfrp-network

# 网络配置（仅在使用 bridge 模式时）
# networks:
#   rfrp-network:
#     driver: bridge
