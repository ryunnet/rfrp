services:
  # ==================== RFRP Client (Agent Client) ====================
  # 客户端服务，运行在内网机器上，连接本地服务并通过节点暴露到公网
  #
  # 使用前请先配置：
  # 1. 复制 .env.example 为 .env
  # 2. 在 .env 中填写实际的 CONTROLLER_URL 和 CLIENT_TOKEN
  # 3. 运行: docker compose up -d
  client:
    image: docker.yunnet.top/all/rfrp:latest
    container_name: rfrp-client
    restart: unless-stopped

    # 网络模式
    # 使用 host 模式可以直接访问宿主机的服务
    # 如果需要访问其他容器，可以使用 bridge 模式并配置网络
    network_mode: host

    # 如果使用 bridge 模式，取消下面的注释并注释掉上面的 network_mode
    # ports:
    #   # 根据需要暴露的本地服务端口调整
    #   # 例如: - "8080:8080"

    # 环境变量（仅用于容器运行时配置）
    environment:
      # 时区设置
      - TZ=Asia/Shanghai
      # 日志级别
      - RUST_LOG=info,tokio_kcp=off

    # 启动命令
    # 注意: ${CONTROLLER_URL} 等变量从 .env 文件或宿主机环境变量读取
    command:
      - /app/client
      - --controller-url
      - ${CONTROLLER_URL}
      - --token
      - ${CLIENT_TOKEN}

    # 如果需要访问宿主机的服务，可以添加 extra_hosts
    # extra_hosts:
    #   - "host.docker.internal:host-gateway"

    # 网络配置（仅在使用 bridge 模式时）
    # networks:
    #   - rfrp-network

# 网络配置（仅在使用 bridge 模式时）
# networks:
#   rfrp-network:
#     driver: bridge
