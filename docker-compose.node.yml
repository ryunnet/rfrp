version: '3.8'

services:
  # ==================== RFRP Node (Agent Server) ====================
  # 节点服务，运行在公网服务器上，提供隧道服务
  #
  # 使用前请先配置：
  # 1. 复制 .env.example 为 .env
  # 2. 在 .env 中填写实际的 CONTROLLER_URL 和 NODE_TOKEN
  # 3. 运行: docker compose up -d
  node:
    image: docker.yunnet.top/all/rfrp:latest
    container_name: rfrp-node
    restart: unless-stopped
    network_mode: host

    # 环境变量（仅用于容器运行时配置）
    environment:
      # 时区设置
      - TZ=Asia/Shanghai
      # 日志级别
      - RUST_LOG=info,tokio_kcp=off

    # 启动命令
    # 注意: ${CONTROLLER_URL} 等变量从 .env 文件或宿主机环境变量读取
    command:
      - /app/agent
      - server
      - --controller-url
      - ${CONTROLLER_URL}
      - --token
      - ${NODE_TOKEN}
      - --bind-port
      - ${BIND_PORT:-7000}

    # 健康检查（可选）
    # healthcheck:
    #   test: ["CMD-SHELL", "netstat -an | grep 7000 || exit 1"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3

    # 网络配置（可选）
    # networks:
    #   - rfrp-network

# 网络配置（可选）
# networks:
#   rfrp-network:
#     driver: bridge
