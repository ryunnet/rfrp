version: '3.8'

services:
  # ==================== RFRP Node (Agent Server) ====================
  # 节点服务，运行在公网服务器上，提供隧道服务
  node:
    image: docker.yunnet.top/all/rfrp:latest
    container_name: rfrp-node
    restart: unless-stopped
    network_mode: host
    # 环境变量
    environment:
      # Controller 地址（必填）
      # 格式: http://controller-ip:3100
      - CONTROLLER_URL=http://8.138.128.12:3100

      # 节点 Token（必填）
      # 从 Controller Web 界面的节点管理页面获取
      - NODE_TOKEN=your-node-token-here

      # 隧道绑定端口（可选，默认 7000）
      - BIND_PORT=7000

      # 时区设置
      - TZ=Asia/Shanghai

      # 日志级别
      - RUST_LOG=info,tokio_kcp=off

    # 启动命令
    command:
      - /app/agent
      - server
      - --controller-url
      - ${CONTROLLER_URL}
      - --token
      - ${NODE_TOKEN}
      - --bind-port
      - ${BIND_PORT:-7000}

    # 健康检查（可选）
    # healthcheck:
    #   test: ["CMD-SHELL", "netstat -an | grep 7000 || exit 1"]
    #   interval: 30s
    #   timeout: 10s
    #   retries: 3

    # 网络配置（可选）
    # networks:
    #   - rfrp-network

# 网络配置（可选）
# networks:
#   rfrp-network:
#     driver: bridge
